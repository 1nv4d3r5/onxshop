<!-- BEGIN: content -->
<!--  BEGIN: init -->
<script type="text/javascript">
/* <![CDATA[ */
function tinyMCEinit () {
	tinyMCE.init({
		mode : "{TINYMCE.mode}",
		elements : "{TINYMCE.edit_elements}",
		theme : "{TINYMCE.theme}",
		editor_selector: "mceAdvanced",
		theme_advanced_toolbar_location : "top",
		theme_advanced_toolbar_align : "left",
		remove_linebreaks : false,
		cleanup_on_startup : true,/*this option was removed in 3.4*/
		content_css: "/share/css/tinymce.css",
		apply_source_formatting : true,
		convert_fonts_to_spans : true,
		gecko_spellcheck : true, 
		invalid_elements : "div,form,input,label,button,script,font",
		verify_css_classes : false,
		inline_styles : true,
		fix_list_elements : true,
		fix_table_elements : true,
		cleanup_callback : "myCustomCleanup",
		relative_urls : false,
		remove_script_host : true,
		document_base_url : "{BASE_URI}/",
		plugins : "table,save,advhr,advimage,advlink,emotions,iespell,insertdatetime,preview,searchreplace,print,contextmenu,loremipsum,inlinepopups,fullscreen,paste,media",
		theme_advanced_buttons2_add : "media,fullscreen",
		theme_advanced_buttons3_add_before : "tablecontrols,separator",
		theme_advanced_buttons3_add : "blockquote,separator,loremipsum,pastetext,pasteword,selectall",
		advlink_styles: "Arrow=arrow",/*for Insert/edit links*/
		plugin_insertdate_dateFormat : "%Y-%m-%d",
		plugin_insertdate_timeFormat : "%H:%M:%S",
		extended_valid_elements : "a[class|name|href|target|title|onclick],img[class|style|src|alt|title|width|height|align|onmouseover|onmouseout|name],hr[class|width|size|noshade],span[class|align|style],code[class|style],obj[param|embed]",
		file_browser_callback : "fileBrowserCallBack",
		paste_auto_cleanup_on_paste : true,
		paste_strip_class_attributes : "all",
		paste_use_dialog : false,
		table_cell_styles : "Odd=odd;"
	});
}

tinyMCEinit ();

  function myFileBrowser (field_name, url, type, win, width, height) {

    //alert("Field_Name: " + field_name + "\nURL: " + url + "\nType: " + type + "\nWin: " + win); // debug/testing

    tinyMCE.activeEditor.windowManager.open({
        file : url,
        title : 'My File Browser',
        width : 720,  // Your dimensions may differ - toy around with them!
        height : 700,
        resizable : "yes",
        inline : "yes",  // This parameter only has an effect if you use the inlinepopups plugin!
        close_previous : "no",
        scrollbars : 1
    }, {
        window : win,
        input : field_name
    });
    return false;
  }

function fileBrowserCallBack(field_name, url, type, win) {
	if (type == 'image') myFileBrowser(field_name, '/popup/files/{GET.relation}/{GET.id}?type=RTE', type, win, 720, 700);
	else myFileBrowser(field_name, '/popup_window/bo/component/node_menu_tinymce~id=0:open={GET.id}:expand_all=1:publish=0~', type, win, 520, 700);
	
	return false;
}

function myCustomCleanup(type, value) {
	switch (type) {
		case "get_from_editor":
			//alert("get_from_editor, Value HTML string: " + value);
			value = value.replace(/\n/g, ' ').replace(/<!--.*?-->/mgi, ' ');
			// Do custom cleanup code here
			break;
		case "insert_to_editor":
			//alert("insert_to_editor, Value HTML string: " + value);
			// Do custom cleanup code here
			break;
		case "submit_content":
			//alert("submit_content, Value HTML Element: " + value);
			// Do custom cleanup code here
			break;
		case "get_from_editor_dom":
			//alert("get_from_editor_dom, Value DOM Element " + value);
			// Do custom cleanup code here
			break;
		case "insert_to_editor_dom":
			//alert("insert_to_editor_dom, Value DOM Element: " + value);
			// Do custom cleanup code here
			break;
		case "setup_content_dom":
			//alert("setup_content_dom, Value DOM Element: " + value);
			// Do custom cleanup code here
			break;
		case "submit_content_dom":
			//alert("submit_content_dom, Value DOM Element: " + value);
			// Do custom cleanup code here
			break;
	}

	return value;
}

$('form').bind('form-pre-serialize', function(e) {
    tinyMCE.triggerSave();
});

/* ]]> */
</script>

<!--  END: init -->
<!-- END: content -->
